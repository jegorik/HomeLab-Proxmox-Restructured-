---
# =============================================================================
# NPM Role - Node.js Installation
# =============================================================================

- name: Add NodeSource GPG key
  ansible.builtin.shell: |
    curl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key | gpg --dearmor -o /etc/apt/trusted.gpg.d/nodesource.gpg
  args:
    creates: /etc/apt/trusted.gpg.d/nodesource.gpg

- name: Add NodeSource repository
  ansible.builtin.copy:
    dest: /etc/apt/sources.list.d/nodesource.list
    content: |
      deb [signed-by=/etc/apt/trusted.gpg.d/nodesource.gpg] https://deb.nodesource.com/node_{{ nodejs_version }}.x nodistro main
    mode: '0644'

- name: Update apt cache after adding NodeSource repo
  ansible.builtin.apt:
    update_cache: true

- name: Install Node.js
  ansible.builtin.apt:
    name: nodejs
    state: present

- name: Install Yarn globally
  community.general.npm:
    name: yarn
    global: true
    state: present
