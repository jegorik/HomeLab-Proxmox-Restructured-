# =============================================================================
# HashiCorp Vault Server Configuration
# =============================================================================
# This configuration file is auto-generated by Ansible from template.
# Manual changes will be overwritten on next Ansible run.
#
# Configuration Reference:
#   https://developer.hashicorp.com/vault/docs/configuration
#
# Location: /etc/vault.d/vault.hcl
# Owner: vault:vault (0640 permissions)
#
# Last Updated: January 2026
# =============================================================================

# Enable Web UI
# Provides browser-based interface for Vault management
# Access: http://<server-ip>:8200/ui
ui = true

# Disable mlock (memory locking)
# IMPORTANT: Must be 'true' for LXC containers
# LXC containers don't have CAP_IPC_LOCK capability required for mlock
#
# Security Impact:
#   - With mlock disabled, secrets could be swapped to disk
#   - In production VMs with proper capabilities, set to 'false'
#   - For LXC, this is a necessary compromise
#
# Alternative: Use encrypted swap or disable swap entirely
disable_mlock = true

# Storage Backend - File-based
# WARNING: Not recommended for production clusters
# File storage is suitable for:
#   - Development environments
#   - Single-server deployments
#   - Testing and demos
#
# Production Alternatives:
#   - Consul (HA capable)
#   - etcd (HA capable)
#   - AWS S3 / DynamoDB
#   - Google Cloud Storage
#   - Azure Blob Storage
#
# Documentation: https://developer.hashicorp.com/vault/docs/configuration/storage/filesystem
storage "file" {
  path = "/var/lib/vault/data"
}

# HTTP Listener
# WARNING: TLS is disabled - not suitable for production without reverse proxy
#
# Current Configuration:
#   - Protocol: HTTP (unencrypted)
#   - Address: 0.0.0.0:8200 (all interfaces)
#   - TLS: Disabled
#
# Production Recommendations:
#   Option 1: Enable TLS directly in Vault
#     tls_disable = 0
#     tls_cert_file = "/path/to/cert.pem"
#     tls_key_file = "/path/to/key.pem"
#
#   Option 2: Use reverse proxy (Nginx/Traefik) with TLS
#     - Vault listens on 127.0.0.1:8200 (localhost only)
#     - Reverse proxy handles TLS termination
#     - Recommended for ease of certificate management
#
# Documentation: https://developer.hashicorp.com/vault/docs/configuration/listener/tcp
listener "tcp" {
  address     = "0.0.0.0:8200"
  tls_disable = 1
}

# API Address
# Address to advertise to other Vault servers in cluster
# For single-server deployments, this is the server's address
# Used for:
#   - Client redirects
#   - Cluster communication
#   - Health check endpoints
api_addr = "http://0.0.0.0:8200"
